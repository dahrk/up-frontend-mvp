{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst defer_to_connect_1 = require(\"defer-to-connect\");\n\nconst nodejsMajorVersion = Number(process.versions.node.split('.')[0]);\n\nconst timer = request => {\n  const timings = {\n    start: Date.now(),\n    socket: undefined,\n    lookup: undefined,\n    connect: undefined,\n    secureConnect: undefined,\n    upload: undefined,\n    response: undefined,\n    end: undefined,\n    error: undefined,\n    abort: undefined,\n    phases: {\n      wait: undefined,\n      dns: undefined,\n      tcp: undefined,\n      tls: undefined,\n      request: undefined,\n      firstByte: undefined,\n      download: undefined,\n      total: undefined\n    }\n  };\n  request.timings = timings;\n\n  const handleError = origin => {\n    const emit = origin.emit.bind(origin);\n\n    origin.emit = (event, ...args) => {\n      // Catches the `error` event\n      if (event === 'error') {\n        timings.error = Date.now();\n        timings.phases.total = timings.error - timings.start;\n        origin.emit = emit;\n      } // Saves the original behavior\n\n\n      return emit(event, ...args);\n    };\n  };\n\n  handleError(request);\n  request.prependOnceListener('abort', () => {\n    timings.abort = Date.now(); // Let the `end` response event be responsible for setting the total phase,\n    // unless the Node.js major version is >= 13.\n\n    if (!timings.response || nodejsMajorVersion >= 13) {\n      timings.phases.total = Date.now() - timings.start;\n    }\n  });\n\n  const onSocket = socket => {\n    timings.socket = Date.now();\n    timings.phases.wait = timings.socket - timings.start;\n\n    const lookupListener = () => {\n      timings.lookup = Date.now();\n      timings.phases.dns = timings.lookup - timings.socket;\n    };\n\n    socket.prependOnceListener('lookup', lookupListener);\n    defer_to_connect_1.default(socket, {\n      connect: () => {\n        timings.connect = Date.now();\n\n        if (timings.lookup === undefined) {\n          socket.removeListener('lookup', lookupListener);\n          timings.lookup = timings.connect;\n          timings.phases.dns = timings.lookup - timings.socket;\n        }\n\n        timings.phases.tcp = timings.connect - timings.lookup; // This callback is called before flushing any data,\n        // so we don't need to set `timings.phases.request` here.\n      },\n      secureConnect: () => {\n        timings.secureConnect = Date.now();\n        timings.phases.tls = timings.secureConnect - timings.connect;\n      }\n    });\n  };\n\n  if (request.socket) {\n    onSocket(request.socket);\n  } else {\n    request.prependOnceListener('socket', onSocket);\n  }\n\n  const onUpload = () => {\n    var _a;\n\n    timings.upload = Date.now();\n    timings.phases.request = timings.upload - (_a = timings.secureConnect, _a !== null && _a !== void 0 ? _a : timings.connect);\n  };\n\n  const writableFinished = () => {\n    if (typeof request.writableFinished === 'boolean') {\n      return request.writableFinished;\n    } // Node.js doesn't have `request.writableFinished` property\n\n\n    return request.finished && request.outputSize === 0 && (!request.socket || request.socket.writableLength === 0);\n  };\n\n  if (writableFinished()) {\n    onUpload();\n  } else {\n    request.prependOnceListener('finish', onUpload);\n  }\n\n  request.prependOnceListener('response', response => {\n    timings.response = Date.now();\n    timings.phases.firstByte = timings.response - timings.upload;\n    response.timings = timings;\n    handleError(response);\n    response.prependOnceListener('end', () => {\n      timings.end = Date.now();\n      timings.phases.download = timings.end - timings.response;\n      timings.phases.total = timings.end - timings.start;\n    });\n  });\n  return timings;\n};\n\nexports.default = timer; // For CommonJS default export support\n\nmodule.exports = timer;\nmodule.exports.default = timer;","map":{"version":3,"sources":["/home/td/code/up-frontend-mvp/node_modules/@szmarczak/http-timer/dist/source/index.js"],"names":["Object","defineProperty","exports","value","defer_to_connect_1","require","nodejsMajorVersion","Number","process","versions","node","split","timer","request","timings","start","Date","now","socket","undefined","lookup","connect","secureConnect","upload","response","end","error","abort","phases","wait","dns","tcp","tls","firstByte","download","total","handleError","origin","emit","bind","event","args","prependOnceListener","onSocket","lookupListener","default","removeListener","onUpload","_a","writableFinished","finished","outputSize","writableLength","module"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst defer_to_connect_1 = require(\"defer-to-connect\");\nconst nodejsMajorVersion = Number(process.versions.node.split('.')[0]);\nconst timer = (request) => {\n    const timings = {\n        start: Date.now(),\n        socket: undefined,\n        lookup: undefined,\n        connect: undefined,\n        secureConnect: undefined,\n        upload: undefined,\n        response: undefined,\n        end: undefined,\n        error: undefined,\n        abort: undefined,\n        phases: {\n            wait: undefined,\n            dns: undefined,\n            tcp: undefined,\n            tls: undefined,\n            request: undefined,\n            firstByte: undefined,\n            download: undefined,\n            total: undefined\n        }\n    };\n    request.timings = timings;\n    const handleError = (origin) => {\n        const emit = origin.emit.bind(origin);\n        origin.emit = (event, ...args) => {\n            // Catches the `error` event\n            if (event === 'error') {\n                timings.error = Date.now();\n                timings.phases.total = timings.error - timings.start;\n                origin.emit = emit;\n            }\n            // Saves the original behavior\n            return emit(event, ...args);\n        };\n    };\n    handleError(request);\n    request.prependOnceListener('abort', () => {\n        timings.abort = Date.now();\n        // Let the `end` response event be responsible for setting the total phase,\n        // unless the Node.js major version is >= 13.\n        if (!timings.response || nodejsMajorVersion >= 13) {\n            timings.phases.total = Date.now() - timings.start;\n        }\n    });\n    const onSocket = (socket) => {\n        timings.socket = Date.now();\n        timings.phases.wait = timings.socket - timings.start;\n        const lookupListener = () => {\n            timings.lookup = Date.now();\n            timings.phases.dns = timings.lookup - timings.socket;\n        };\n        socket.prependOnceListener('lookup', lookupListener);\n        defer_to_connect_1.default(socket, {\n            connect: () => {\n                timings.connect = Date.now();\n                if (timings.lookup === undefined) {\n                    socket.removeListener('lookup', lookupListener);\n                    timings.lookup = timings.connect;\n                    timings.phases.dns = timings.lookup - timings.socket;\n                }\n                timings.phases.tcp = timings.connect - timings.lookup;\n                // This callback is called before flushing any data,\n                // so we don't need to set `timings.phases.request` here.\n            },\n            secureConnect: () => {\n                timings.secureConnect = Date.now();\n                timings.phases.tls = timings.secureConnect - timings.connect;\n            }\n        });\n    };\n    if (request.socket) {\n        onSocket(request.socket);\n    }\n    else {\n        request.prependOnceListener('socket', onSocket);\n    }\n    const onUpload = () => {\n        var _a;\n        timings.upload = Date.now();\n        timings.phases.request = timings.upload - (_a = timings.secureConnect, (_a !== null && _a !== void 0 ? _a : timings.connect));\n    };\n    const writableFinished = () => {\n        if (typeof request.writableFinished === 'boolean') {\n            return request.writableFinished;\n        }\n        // Node.js doesn't have `request.writableFinished` property\n        return request.finished && request.outputSize === 0 && (!request.socket || request.socket.writableLength === 0);\n    };\n    if (writableFinished()) {\n        onUpload();\n    }\n    else {\n        request.prependOnceListener('finish', onUpload);\n    }\n    request.prependOnceListener('response', (response) => {\n        timings.response = Date.now();\n        timings.phases.firstByte = timings.response - timings.upload;\n        response.timings = timings;\n        handleError(response);\n        response.prependOnceListener('end', () => {\n            timings.end = Date.now();\n            timings.phases.download = timings.end - timings.response;\n            timings.phases.total = timings.end - timings.start;\n        });\n    });\n    return timings;\n};\nexports.default = timer;\n// For CommonJS default export support\nmodule.exports = timer;\nmodule.exports.default = timer;\n"]},"metadata":{},"sourceType":"script"}